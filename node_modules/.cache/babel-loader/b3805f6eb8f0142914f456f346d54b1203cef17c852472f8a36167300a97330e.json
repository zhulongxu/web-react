{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { Dom } from '@antv/x6-common';\nimport { Point } from '@antv/x6-geometry';\nimport { ToolsView } from '../../view/tool';\nclass Arrowhead extends ToolsView.ToolItem {\n  get type() {\n    return this.options.type;\n  }\n  get ratio() {\n    return this.options.ratio;\n  }\n  init() {\n    if (this.options.attrs) {\n      const _a = this.options.attrs,\n        {\n          class: className\n        } = _a,\n        attrs = __rest(_a, [\"class\"]);\n      this.setAttrs(attrs, this.container);\n      if (className) {\n        Dom.addClass(this.container, className);\n      }\n    }\n  }\n  onRender() {\n    Dom.addClass(this.container, this.prefixClassName(`edge-tool-${this.type}-arrowhead`));\n    this.update();\n  }\n  update() {\n    const ratio = this.ratio;\n    const edgeView = this.cellView;\n    const tangent = edgeView.getTangentAtRatio(ratio);\n    const position = tangent ? tangent.start : edgeView.getPointAtRatio(ratio);\n    const angle = tangent && tangent.vector().vectorAngle(new Point(1, 0)) || 0;\n    if (!position) {\n      return this;\n    }\n    const matrix = Dom.createSVGMatrix().translate(position.x, position.y).rotate(angle);\n    Dom.transform(this.container, matrix, {\n      absolute: true\n    });\n    return this;\n  }\n  onMouseDown(evt) {\n    if (this.guard(evt)) {\n      return;\n    }\n    evt.stopPropagation();\n    evt.preventDefault();\n    const edgeView = this.cellView;\n    if (edgeView.can('arrowheadMovable')) {\n      edgeView.cell.startBatch('move-arrowhead', {\n        ui: true,\n        toolId: this.cid\n      });\n      const coords = this.graph.snapToGrid(evt.clientX, evt.clientY);\n      const data = edgeView.prepareArrowheadDragging(this.type, {\n        x: coords.x,\n        y: coords.y,\n        options: Object.assign(Object.assign({}, this.options), {\n          toolId: this.cid\n        })\n      });\n      this.cellView.setEventData(evt, data);\n      this.delegateDocumentEvents(this.options.documentEvents, evt.data);\n      edgeView.graph.view.undelegateEvents();\n      this.container.style.pointerEvents = 'none';\n    }\n    this.focus();\n  }\n  onMouseMove(evt) {\n    const e = this.normalizeEvent(evt);\n    const coords = this.graph.snapToGrid(e.clientX, e.clientY);\n    this.cellView.onMouseMove(e, coords.x, coords.y);\n    this.update();\n  }\n  onMouseUp(evt) {\n    this.undelegateDocumentEvents();\n    const e = this.normalizeEvent(evt);\n    const edgeView = this.cellView;\n    const coords = this.graph.snapToGrid(e.clientX, e.clientY);\n    edgeView.onMouseUp(e, coords.x, coords.y);\n    this.graph.view.delegateEvents();\n    this.blur();\n    this.container.style.pointerEvents = '';\n    edgeView.cell.stopBatch('move-arrowhead', {\n      ui: true,\n      toolId: this.cid\n    });\n  }\n}\n(function (Arrowhead) {\n  Arrowhead.config({\n    tagName: 'path',\n    isSVGElement: true,\n    events: {\n      mousedown: 'onMouseDown',\n      touchstart: 'onMouseDown'\n    },\n    documentEvents: {\n      mousemove: 'onMouseMove',\n      touchmove: 'onMouseMove',\n      mouseup: 'onMouseUp',\n      touchend: 'onMouseUp',\n      touchcancel: 'onMouseUp'\n    }\n  });\n})(Arrowhead || (Arrowhead = {}));\nexport const SourceArrowhead = Arrowhead.define({\n  name: 'source-arrowhead',\n  type: 'source',\n  ratio: 0,\n  attrs: {\n    d: 'M 10 -8 -10 0 10 8 Z',\n    fill: '#333',\n    stroke: '#fff',\n    'stroke-width': 2,\n    cursor: 'move'\n  }\n});\nexport const TargetArrowhead = Arrowhead.define({\n  name: 'target-arrowhead',\n  type: 'target',\n  ratio: 1,\n  attrs: {\n    d: 'M -10 -8 10 0 -10 8 Z',\n    fill: '#333',\n    stroke: '#fff',\n    'stroke-width': 2,\n    cursor: 'move'\n  }\n});","map":{"version":3,"names":["Dom","Point","ToolsView","Arrowhead","ToolItem","type","options","ratio","init","attrs","_a","class","className","__rest","setAttrs","container","addClass","onRender","prefixClassName","update","edgeView","cellView","tangent","getTangentAtRatio","position","start","getPointAtRatio","angle","vector","vectorAngle","matrix","createSVGMatrix","translate","x","y","rotate","transform","absolute","onMouseDown","evt","guard","stopPropagation","preventDefault","can","cell","startBatch","ui","toolId","cid","coords","graph","snapToGrid","clientX","clientY","data","prepareArrowheadDragging","Object","assign","setEventData","delegateDocumentEvents","documentEvents","view","undelegateEvents","style","pointerEvents","focus","onMouseMove","e","normalizeEvent","onMouseUp","undelegateDocumentEvents","delegateEvents","blur","stopBatch","config","tagName","isSVGElement","events","mousedown","touchstart","mousemove","touchmove","mouseup","touchend","touchcancel","SourceArrowhead","define","name","d","fill","stroke","cursor","TargetArrowhead"],"sources":["/home/devbox/project/node_modules/.pnpm/@antv+x6@2.18.1/node_modules/@antv/x6/src/registry/tool/arrowhead.ts"],"sourcesContent":["import { Dom } from '@antv/x6-common'\nimport { Point } from '@antv/x6-geometry'\nimport { Attr } from '../attr'\nimport { Edge } from '../../model/edge'\nimport { EdgeView } from '../../view/edge'\nimport { ToolsView } from '../../view/tool'\n\nclass Arrowhead extends ToolsView.ToolItem<EdgeView, Arrowhead.Options> {\n  protected get type() {\n    return this.options.type!\n  }\n\n  protected get ratio() {\n    return this.options.ratio!\n  }\n\n  protected init() {\n    if (this.options.attrs) {\n      const { class: className, ...attrs } = this.options.attrs\n      this.setAttrs(attrs, this.container)\n      if (className) {\n        Dom.addClass(this.container, className as string)\n      }\n    }\n  }\n\n  protected onRender() {\n    Dom.addClass(\n      this.container,\n      this.prefixClassName(`edge-tool-${this.type}-arrowhead`),\n    )\n    this.update()\n  }\n\n  update() {\n    const ratio = this.ratio\n    const edgeView = this.cellView as EdgeView\n    const tangent = edgeView.getTangentAtRatio(ratio)\n    const position = tangent ? tangent.start : edgeView.getPointAtRatio(ratio)\n    const angle =\n      (tangent && tangent.vector().vectorAngle(new Point(1, 0))) || 0\n\n    if (!position) {\n      return this\n    }\n\n    const matrix = Dom.createSVGMatrix()\n      .translate(position.x, position.y)\n      .rotate(angle)\n\n    Dom.transform(this.container as SVGElement, matrix, { absolute: true })\n\n    return this\n  }\n\n  protected onMouseDown(evt: Dom.MouseDownEvent) {\n    if (this.guard(evt)) {\n      return\n    }\n\n    evt.stopPropagation()\n    evt.preventDefault()\n\n    const edgeView = this.cellView as EdgeView\n\n    if (edgeView.can('arrowheadMovable')) {\n      edgeView.cell.startBatch('move-arrowhead', {\n        ui: true,\n        toolId: this.cid,\n      })\n\n      const coords = this.graph.snapToGrid(evt.clientX, evt.clientY)\n      const data = edgeView.prepareArrowheadDragging(this.type, {\n        x: coords.x,\n        y: coords.y,\n        options: {\n          ...this.options,\n          toolId: this.cid,\n        },\n      })\n      this.cellView.setEventData(evt, data)\n      this.delegateDocumentEvents(this.options.documentEvents!, evt.data)\n      edgeView.graph.view.undelegateEvents()\n\n      this.container.style.pointerEvents = 'none'\n    }\n\n    this.focus()\n  }\n\n  protected onMouseMove(evt: Dom.MouseMoveEvent) {\n    const e = this.normalizeEvent(evt)\n    const coords = this.graph.snapToGrid(e.clientX, e.clientY)\n    this.cellView.onMouseMove(e, coords.x, coords.y)\n    this.update()\n  }\n\n  protected onMouseUp(evt: Dom.MouseUpEvent) {\n    this.undelegateDocumentEvents()\n    const e = this.normalizeEvent(evt)\n    const edgeView = this.cellView\n    const coords = this.graph.snapToGrid(e.clientX, e.clientY)\n    edgeView.onMouseUp(e, coords.x, coords.y)\n    this.graph.view.delegateEvents()\n    this.blur()\n    this.container.style.pointerEvents = ''\n    edgeView.cell.stopBatch('move-arrowhead', {\n      ui: true,\n      toolId: this.cid,\n    })\n  }\n}\n\nnamespace Arrowhead {\n  export interface Options extends ToolsView.ToolItem.Options {\n    attrs?: Attr.SimpleAttrs\n    type?: Edge.TerminalType\n    ratio?: number\n  }\n}\n\nnamespace Arrowhead {\n  Arrowhead.config({\n    tagName: 'path',\n    isSVGElement: true,\n    events: {\n      mousedown: 'onMouseDown',\n      touchstart: 'onMouseDown',\n    },\n    documentEvents: {\n      mousemove: 'onMouseMove',\n      touchmove: 'onMouseMove',\n      mouseup: 'onMouseUp',\n      touchend: 'onMouseUp',\n      touchcancel: 'onMouseUp',\n    },\n  })\n}\n\nexport const SourceArrowhead = Arrowhead.define<Arrowhead.Options>({\n  name: 'source-arrowhead',\n  type: 'source',\n  ratio: 0,\n  attrs: {\n    d: 'M 10 -8 -10 0 10 8 Z',\n    fill: '#333',\n    stroke: '#fff',\n    'stroke-width': 2,\n    cursor: 'move',\n  },\n})\n\nexport const TargetArrowhead = Arrowhead.define<Arrowhead.Options>({\n  name: 'target-arrowhead',\n  type: 'target',\n  ratio: 1,\n  attrs: {\n    d: 'M -10 -8 10 0 -10 8 Z',\n    fill: '#333',\n    stroke: '#fff',\n    'stroke-width': 2,\n    cursor: 'move',\n  },\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}