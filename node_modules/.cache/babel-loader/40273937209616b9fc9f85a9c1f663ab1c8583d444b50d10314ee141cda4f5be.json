{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { ModifierKey, Dom, NumberExt, Disposable } from '@antv/x6-common';\nimport { Base } from './base';\nexport class MouseWheel extends Base {\n  constructor() {\n    super(...arguments);\n    this.cumulatedFactor = 1;\n  }\n  get widgetOptions() {\n    return this.options.mousewheel;\n  }\n  init() {\n    this.container = this.graph.container;\n    this.target = this.widgetOptions.global ? document : this.container;\n    this.mousewheelHandle = new Dom.MouseWheelHandle(this.target, this.onMouseWheel.bind(this), this.allowMouseWheel.bind(this));\n    if (this.widgetOptions.enabled) {\n      this.enable(true);\n    }\n  }\n  get disabled() {\n    return this.widgetOptions.enabled !== true;\n  }\n  enable(force) {\n    if (this.disabled || force) {\n      this.widgetOptions.enabled = true;\n      this.mousewheelHandle.enable();\n    }\n  }\n  disable() {\n    if (!this.disabled) {\n      this.widgetOptions.enabled = false;\n      this.mousewheelHandle.disable();\n    }\n  }\n  allowMouseWheel(e) {\n    const guard = this.widgetOptions.guard;\n    return (guard == null || guard(e)) && ModifierKey.isMatch(e, this.widgetOptions.modifiers);\n  }\n  onMouseWheel(e) {\n    const guard = this.widgetOptions.guard;\n    if ((guard == null || guard(e)) && ModifierKey.isMatch(e, this.widgetOptions.modifiers)) {\n      const factor = this.widgetOptions.factor || 1.2;\n      if (this.currentScale == null) {\n        this.startPos = {\n          x: e.clientX,\n          y: e.clientY\n        };\n        this.currentScale = this.graph.transform.getScale().sx;\n      }\n      const delta = e.deltaY;\n      if (delta < 0) {\n        // zoomin\n        // ------\n        // Switches to 1% zoom steps below 15%\n        if (this.currentScale < 0.15) {\n          this.cumulatedFactor = (this.currentScale + 0.01) / this.currentScale;\n        } else {\n          // Uses to 5% zoom steps for better grid rendering in\n          // webkit and to avoid rounding errors for zoom steps\n          this.cumulatedFactor = Math.round(this.currentScale * factor * 20) / 20 / this.currentScale;\n          if (this.cumulatedFactor === 1) {\n            this.cumulatedFactor = 1.05;\n          }\n        }\n      } else {\n        // zoomout\n        // -------\n        // Switches to 1% zoom steps below 15%\n        if (this.currentScale <= 0.15) {\n          this.cumulatedFactor = (this.currentScale - 0.01) / this.currentScale;\n        } else {\n          // Uses to 5% zoom steps for better grid rendering in\n          // webkit and to avoid rounding errors for zoom steps\n          this.cumulatedFactor = Math.round(this.currentScale * (1 / factor) * 20) / 20 / this.currentScale;\n          if (this.cumulatedFactor === 1) {\n            this.cumulatedFactor = 0.95;\n          }\n        }\n      }\n      this.cumulatedFactor = Math.max(0.01, Math.min(this.currentScale * this.cumulatedFactor, 160) / this.currentScale);\n      const currentScale = this.currentScale;\n      let targetScale = this.graph.transform.clampScale(currentScale * this.cumulatedFactor);\n      const minScale = this.widgetOptions.minScale || Number.MIN_SAFE_INTEGER;\n      const maxScale = this.widgetOptions.maxScale || Number.MAX_SAFE_INTEGER;\n      targetScale = NumberExt.clamp(targetScale, minScale, maxScale);\n      if (targetScale !== currentScale) {\n        if (this.widgetOptions.zoomAtMousePosition) {\n          const hasScroller = !!this.graph.getPlugin('scroller');\n          const origin = hasScroller ? this.graph.clientToLocal(this.startPos) : this.graph.clientToGraph(this.startPos);\n          this.graph.zoom(targetScale, {\n            absolute: true,\n            center: origin.clone()\n          });\n        } else {\n          this.graph.zoom(targetScale, {\n            absolute: true\n          });\n        }\n      }\n      this.currentScale = null;\n      this.cumulatedFactor = 1;\n    }\n  }\n  dispose() {\n    this.disable();\n  }\n}\n__decorate([Disposable.dispose()], MouseWheel.prototype, \"dispose\", null);","map":{"version":3,"names":["ModifierKey","Dom","NumberExt","Disposable","Base","MouseWheel","constructor","cumulatedFactor","widgetOptions","options","mousewheel","init","container","graph","target","global","document","mousewheelHandle","MouseWheelHandle","onMouseWheel","bind","allowMouseWheel","enabled","enable","disabled","force","disable","e","guard","isMatch","modifiers","factor","currentScale","startPos","x","clientX","y","clientY","transform","getScale","sx","delta","deltaY","Math","round","max","min","targetScale","clampScale","minScale","Number","MIN_SAFE_INTEGER","maxScale","MAX_SAFE_INTEGER","clamp","zoomAtMousePosition","hasScroller","getPlugin","origin","clientToLocal","clientToGraph","zoom","absolute","center","clone","dispose","__decorate"],"sources":["/home/devbox/project/node_modules/.pnpm/@antv+x6@2.18.1/node_modules/@antv/x6/src/graph/mousewheel.ts"],"sourcesContent":["import { ModifierKey, Dom, NumberExt, Disposable } from '@antv/x6-common'\nimport { Base } from './base'\n\nexport class MouseWheel extends Base {\n  public target: HTMLElement | Document\n  public container: HTMLElement\n\n  protected cumulatedFactor = 1\n  protected currentScale: number | null\n  protected startPos: { x: number; y: number }\n\n  private mousewheelHandle: Dom.MouseWheelHandle\n\n  protected get widgetOptions() {\n    return this.options.mousewheel\n  }\n\n  protected init() {\n    this.container = this.graph.container\n    this.target = this.widgetOptions.global ? document : this.container\n    this.mousewheelHandle = new Dom.MouseWheelHandle(\n      this.target,\n      this.onMouseWheel.bind(this),\n      this.allowMouseWheel.bind(this),\n    )\n    if (this.widgetOptions.enabled) {\n      this.enable(true)\n    }\n  }\n\n  get disabled() {\n    return this.widgetOptions.enabled !== true\n  }\n\n  enable(force?: boolean) {\n    if (this.disabled || force) {\n      this.widgetOptions.enabled = true\n      this.mousewheelHandle.enable()\n    }\n  }\n\n  disable() {\n    if (!this.disabled) {\n      this.widgetOptions.enabled = false\n      this.mousewheelHandle.disable()\n    }\n  }\n\n  protected allowMouseWheel(e: WheelEvent) {\n    const guard = this.widgetOptions.guard\n\n    return (\n      (guard == null || guard(e)) &&\n      ModifierKey.isMatch(e, this.widgetOptions.modifiers)\n    )\n  }\n\n  protected onMouseWheel(e: WheelEvent) {\n    const guard = this.widgetOptions.guard\n\n    if (\n      (guard == null || guard(e)) &&\n      ModifierKey.isMatch(e, this.widgetOptions.modifiers)\n    ) {\n      const factor = this.widgetOptions.factor || 1.2\n\n      if (this.currentScale == null) {\n        this.startPos = { x: e.clientX, y: e.clientY }\n        this.currentScale = this.graph.transform.getScale().sx\n      }\n\n      const delta = e.deltaY\n      if (delta < 0) {\n        // zoomin\n        // ------\n        // Switches to 1% zoom steps below 15%\n        if (this.currentScale < 0.15) {\n          this.cumulatedFactor = (this.currentScale + 0.01) / this.currentScale\n        } else {\n          // Uses to 5% zoom steps for better grid rendering in\n          // webkit and to avoid rounding errors for zoom steps\n          this.cumulatedFactor =\n            Math.round(this.currentScale * factor * 20) / 20 / this.currentScale\n          if (this.cumulatedFactor === 1) {\n            this.cumulatedFactor = 1.05\n          }\n        }\n      } else {\n        // zoomout\n        // -------\n        // Switches to 1% zoom steps below 15%\n        if (this.currentScale <= 0.15) {\n          this.cumulatedFactor = (this.currentScale - 0.01) / this.currentScale\n        } else {\n          // Uses to 5% zoom steps for better grid rendering in\n          // webkit and to avoid rounding errors for zoom steps\n          this.cumulatedFactor =\n            Math.round(this.currentScale * (1 / factor) * 20) /\n            20 /\n            this.currentScale\n          if (this.cumulatedFactor === 1) {\n            this.cumulatedFactor = 0.95\n          }\n        }\n      }\n\n      this.cumulatedFactor = Math.max(\n        0.01,\n        Math.min(this.currentScale * this.cumulatedFactor, 160) /\n          this.currentScale,\n      )\n\n      const currentScale = this.currentScale!\n      let targetScale = this.graph.transform.clampScale(\n        currentScale * this.cumulatedFactor,\n      )\n      const minScale = this.widgetOptions.minScale || Number.MIN_SAFE_INTEGER\n      const maxScale = this.widgetOptions.maxScale || Number.MAX_SAFE_INTEGER\n      targetScale = NumberExt.clamp(targetScale, minScale, maxScale)\n\n      if (targetScale !== currentScale) {\n        if (this.widgetOptions.zoomAtMousePosition) {\n          const hasScroller = !!this.graph.getPlugin<any>('scroller')\n          const origin = hasScroller\n            ? this.graph.clientToLocal(this.startPos)\n            : this.graph.clientToGraph(this.startPos)\n          this.graph.zoom(targetScale, {\n            absolute: true,\n            center: origin.clone(),\n          })\n        } else {\n          this.graph.zoom(targetScale, { absolute: true })\n        }\n      }\n      this.currentScale = null\n      this.cumulatedFactor = 1\n    }\n  }\n\n  @Disposable.dispose()\n  dispose() {\n    this.disable()\n  }\n}\n\nexport namespace MouseWheel {\n  export interface Options {\n    enabled?: boolean\n    global?: boolean\n    factor?: number\n    minScale?: number\n    maxScale?: number\n    modifiers?: string | ModifierKey[] | null\n    guard?: (e: WheelEvent) => boolean\n    zoomAtMousePosition?: boolean\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}